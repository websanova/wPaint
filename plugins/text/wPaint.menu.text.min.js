/*! wPaint - v2.5.0 - 2017-12-05 */
!function(t){t.fn.wPaint.menus.text={img:"plugins/text/img/icons-menu-text.png",items:{bold:{icon:"toggle",title:"Bold",index:0,callback:function(t){this.setFontBold(t)}},italic:{icon:"toggle",title:"Italic",index:1,callback:function(t){this.setFontItalic(t)}},fontSize:{title:"Font Size",icon:"select",range:[8,9,10,12,14,16,20,24,30],value:12,callback:function(t){this.setFontSize(t)}},fontFamily:{icon:"select",title:"Font Family",range:["Arial","Courier","Times","Verdana"],useRange:!0,value:"Arial",callback:function(t){this.setFontFamily(t)}}}},t.fn.wPaint.menus.main.items.text={icon:"menu",after:"pencil",title:"Text",index:7,callback:function(){this.setMode("text")}},t.extend(t.fn.wPaint.defaults,{fontSize:"12",fontFamily:"Arial",fontBold:!1,fontItalic:!1,fontUnderline:!1}),t.fn.wPaint.extend({generate:function(){this.$textCalc=t("<div></div>").hide(),this.$textInput=t('<textarea class="wPaint-text-input" spellcheck="false"></textarea>').on("mousedown",this._stopPropagation).css({position:"absolute"}).hide(),t("body").append(this.$textCalc),this.$el.append(this.$textInput),this.menus.all.text=this._createMenu("text")},_init:function(){function i(){n._drawTextIfNotEmpty(),n.$textInput.hide(),n.$canvasTemp.hide()}var n=this;for(var e in this.menus.all)this.menus.all[e].$menu.on("click",i).on("mousedown",this._stopPropagation);t(document).on("mousedown",i)},setFillStyle:function(t){this.$textInput.css("color",t)},setFontSize:function(t){this.options.fontSize=parseInt(t,10),this._setFont({fontSize:t+"px",lineHeight:t+"px"}),this.menus.all.text._setSelectValue("fontSize",t)},setFontFamily:function(t){this.options.fontFamily=t,this._setFont({fontFamily:t}),this.menus.all.text._setSelectValue("fontFamily",t)},setFontBold:function(t){this.options.fontBold=t,this._setFont({fontWeight:t?"bold":""})},setFontItalic:function(t){this.options.fontItalic=t,this._setFont({fontStyle:t?"italic":""})},setFontUnderline:function(t){this.options.fontUnderline=t,this._setFont({fontWeight:t?"underline":""})},_setFont:function(t){this.$textInput.css(t),this.$textCalc.css(t)},_drawTextDown:function(t){this._drawTextIfNotEmpty(),this._drawShapeDown(t,1),this.$textInput.css({left:t.pageX-1,top:t.pageY-1,width:0,height:0}).show().focus()},_drawTextMove:function(t){this._drawShapeMove(t,1),this.$textInput.css({left:t.left-1,top:t.top-1,width:t.width,height:t.height})},_drawTextIfNotEmpty:function(){""!==this.$textInput.val()&&this._drawText()},_drawText:function(){var t,i,n,e,o="",s=this.$textInput.val().split("\n"),l=[],a=this.$textInput.width()-2,h=0,c=this.$textInput.position(),f=c.left+1,u=c.top+1;for(this.options.fontItalic&&(o+="italic "),this.options.fontBold&&(o+="bold "),o+=this.options.fontSize+"px "+this.options.fontFamily,t=0,i=s.length;t<i;t++){for(this.$textCalc.html(""),h=0,n=0,e=s[0].length;n<e;n++)this.$textCalc.append(s[t][n]).width()>a&&(l.push(s[t].substring(h,n)),h=n,this.$textCalc.html(s[t][n]));h!==n&&l.push(s[t].substring(h,n))}for(t=0,i=(s=this.$textInput.val(l.join("\n")).val().split("\n")).length;t<i;t++)this.ctx.fillStyle=this.options.fillStyle,this.ctx.textBaseline="top",this.ctx.font=o,this.ctx.fillText(s[t],f,u),u+=this.options.fontSize;this.$textInput.val(""),this._addUndo()}})}(jQuery);