/*! wPaint - v2.5.0 - 2017-12-05 */
!function(t){"use strict";function e(e,n){this.$el=t(e),this.options=n,this.init=!1,this.menus={primary:null,active:null,all:{}},this.previousMode=null,this.width=this.$el.width(),this.height=this.$el.height(),this.ctxBgResize=!1,this.ctxResize=!1,this.generate(),this._init()}function n(t,e,n){this.wPaint=t,this.options=n,this.name=e,this.type=t.menus.primary?"secondary":"primary",this.docked=!0,this.dockOffset={left:0,top:0},this.generate()}e.prototype={generate:function(){function e(e){var i=e?e.capitalize():"",s="canvas"+i,a="ctx"+i;return n[s]=document.createElement("canvas"),n[a]=n[s].getContext("2d"),n["$"+s]=t(n[s]),n["$"+s].attr("class","wPaint-canvas"+(e?"-"+e:"")).attr("width",n.width+"px").attr("height",n.height+"px").css({position:"absolute",left:0,top:0}),n.$el.append(n["$"+s]),n["$"+s]}if(this.init)return this;var n=this;e("bg"),e("").on("mousedown",function(t){t.preventDefault(),t.stopPropagation(),n.draw=!0,t.canvasEvent="down",n._closeSelectBoxes(),n._callShapeFunc.apply(n,[t])}).bindMobileEvents(),e("temp").hide(),t(document).on("mousemove",function(t){n.draw&&(t.canvasEvent="move",n._callShapeFunc.apply(n,[t]))}).on("mousedown",t.proxy(this._closeSelectBoxes,this)).on("mouseup",function(t){n.draw&&(n.draw=!1,t.canvasEvent="up",n._callShapeFunc.apply(n,[t]))}),this.setTheme(this.options.theme)},_init:function(){var t=null,e=null;this.init=!0;for(t in this.options)this[e="set"+t.capitalize()]&&this[e](this.options[t]);this._fixMenus(),this.menus.primary._getIcon(this.options.mode).trigger("click")},resize:function(){var t=this.getBg(),e=this.getImage();this.width=this.$el.width(),this.height=this.$el.height(),this.canvasBg.width=this.width,this.canvasBg.height=this.height,this.canvas.width=this.width,this.canvas.height=this.height,!1===this.ctxBgResize&&(this.ctxBgResize=!0,this.setBg(t,!0)),!1===this.ctxResize&&(this.ctxResize=!0,this.setImage(e,"",!0,!0))},setTheme:function(t){var e,n;for(t=t.split(" "),this.$el.attr("class",(this.$el.attr("class")||"").replace(/wPaint-theme-.+\s|wPaint-theme-.+$/,"")),e=0,n=t.length;e<n;e++)this.$el.addClass("wPaint-theme-"+t[e])},setMode:function(t){this.setCursor(t),this.previousMode=this.options.mode,this.options.mode=t},setImage:function(e,n,i,s){if(!e)return!0;var a=this,o=null,h="";n="ctx"+(n||"").capitalize(),h=this[n],window.rgbHex(e)?(h.clearRect(0,0,this.width,this.height),h.fillStyle=e,h.rect(0,0,this.width,this.height),h.fill()):((o=new Image).src=e.toString(),t(o).load(function(){var t=1,e=0,c=0,r=0,l=0,u=o.width,p=o.height;i||((o.width>a.width||o.height>a.height||a.options.imageStretch)&&(t=(e=a.width/o.width)<(c=a.height/o.height)?e:c,u=o.width*t,p=o.height*t),r=(a.width-u)/2,l=(a.height-p)/2),h.clearRect(0,0,a.width,a.height),h.drawImage(o,r,l,u,p),a[n+"Resize"]=!1,s||a._addUndo()}))},setBg:function(t,e){if(!t)return!0;this.setImage(t,"bg",e,!0)},setCursor:function(e){e=t.fn.wPaint.cursors[e]||t.fn.wPaint.cursors.default,this.$el.css("cursor",'url("'+this.options.path+e.path+'") '+e.left+" "+e.top+", default")},setMenuOrientation:function(e){t.each(this.menus.all,function(t,n){n.options.aligment=e,n.setAlignment(e)})},getImage:function(e){var n=document.createElement("canvas"),i=n.getContext("2d");return e=!1!==e,t(n).css({display:"none",position:"absolute",left:0,top:0}).attr("width",this.width).attr("height",this.height),e&&i.drawImage(this.canvasBg,0,0),i.drawImage(this.canvas,0,0),n.toDataURL()},getBg:function(){return this.canvasBg.toDataURL()},_displayStatus:function(e){var n=this;this.$status||(this.$status=t('<div class="wPaint-status"></div>'),this.$el.append(this.$status)),this.$status.html(e),clearTimeout(this.displayStatusTimer),this.$status.fadeIn(500,function(){n.displayStatusTimer=setTimeout(function(){n.$status.fadeOut(500)},1500)})},_showModal:function(t){var e=this,n=this.$el.children(".wPaint-modal-bg"),i=this.$el.children(".wPaint-modal");n.length?i.fadeOut(500,function(){n.remove(),i.remove(),e._createModal(t)}):this._createModal(t)},_createModal:function(e){function n(){i.remove(),s.remove()}e=t('<div class="wPaint-modal-content"></div>').append(e.children());var i=t('<div class="wPaint-modal-bg"></div>'),s=t('<div class="wPaint-modal"></div>'),a=t('<div class="wPaint-modal-holder"></div>'),o=t('<div class="wPaint-modal-close">X</div>');o.on("click",function(){s.fadeOut(500,n)}),s.append(a.append(e)).append(o),this.$el.append(i).append(s),s.css({left:this.$el.outerWidth()/2-s.outerWidth(!0)/2,top:this.$el.outerHeight()/2-s.outerHeight(!0)/2}),s.fadeIn(500)},_createMenu:function(t,e){return e=e||{},e.alignment=this.options.menuOrientation,e.handle=this.options.menuHandle,new n(this,t,e)},_fixMenus:function(){function e(e,i){var s=t(i),a=s.clone();a.appendTo(n.$el),a.outerHeight()===a.get(0).scrollHeight&&s.css({overflowY:"auto"}),a.remove()}var n=this,i=null;for(var s in this.menus.all)(i=n.menus.all[s].$menu.find(".wPaint-menu-select-holder")).length&&i.children().each(e)},_closeSelectBoxes:function(t){var e,n;for(e in this.menus.all)n=this.menus.all[e].$menuHolder.children(".wPaint-menu-icon-select"),t&&(n=n.not(".wPaint-menu-icon-name-"+t.name)),n.children(".wPaint-menu-select-holder").hide()},_callShapeFunc:function(t){var e=this.$canvas.offset(),n=t.canvasEvent.capitalize(),i="_draw"+this.options.mode.capitalize()+n;t.pageX=Math.floor(t.pageX-e.left),t.pageY=Math.floor(t.pageY-e.top),this[i]&&this[i].apply(this,[t]),this.options["draw"+n]&&this.options["_draw"+n].apply(this,[t]),"Down"===n&&this.options.onShapeDown?this.options.onShapeDown.apply(this,[t]):"Move"===n&&this.options.onShapeMove?this.options.onShapeMove.apply(this,[t]):"Up"===n&&this.options.onShapeUp&&this.options.onShapeUp.apply(this,[t])},_stopPropagation:function(t){t.stopPropagation()},_drawShapeDown:function(t){this.$canvasTemp.css({left:t.PageX,top:t.PageY}).attr("width",0).attr("height",0).show(),this.canvasTempLeftOriginal=t.pageX,this.canvasTempTopOriginal=t.pageY},_drawShapeMove:function(e,n){var i=this.canvasTempLeftOriginal,s=this.canvasTempTopOriginal;n=n||2,e.left=e.pageX<i?e.pageX:i,e.top=e.pageY<s?e.pageY:s,e.width=Math.abs(e.pageX-i),e.height=Math.abs(e.pageY-s),e.x=this.options.lineWidth/2*n,e.y=this.options.lineWidth/2*n,e.w=e.width-this.options.lineWidth*n,e.h=e.height-this.options.lineWidth*n,t(this.canvasTemp).css({left:e.left,top:e.top}).attr("width",e.width).attr("height",e.height),this.canvasTempLeftNew=e.left,this.canvasTempTopNew=e.top,n=n||2,this.ctxTemp.fillStyle=this.options.fillStyle,this.ctxTemp.strokeStyle=this.options.strokeStyle,this.ctxTemp.lineWidth=this.options.lineWidth*n},_drawShapeUp:function(){this.ctx.drawImage(this.canvasTemp,this.canvasTempLeftNew,this.canvasTempTopNew),this.$canvasTemp.hide()},_drawDropperDown:function(t){var e={x:t.pageX,y:t.pageY},n=this._getPixel(this.ctx,e),i=null;i="rgba("+[n.r,n.g,n.b,n.a].join(",")+")",this.options[this.dropper]=i,this.menus.active._getIcon(this.dropper).wColorPicker("color",i)},_drawDropperUp:function(){this.setMode(this.previousMode)},_getPixel:function(t,e){var n=t.getImageData(0,0,this.width,this.height),i=n.data,s=4*(e.y*n.width+e.x);return{r:i[s],g:i[s+1],b:i[s+2],a:i[s+3]}}},n.prototype={generate:function(){this.$menu=t('<div class="wPaint-menu"></div>'),this.$menuHolder=t('<div class="wPaint-menu-holder wPaint-menu-name-'+this.name+'"></div>'),this.options.handle?this.$menuHandle=this._createHandle():this.$menu.addClass("wPaint-menu-nohandle"),"primary"===this.type?(this.wPaint.menus.primary=this,this.setOffsetLeft(this.options.offsetLeft),this.setOffsetTop(this.options.offsetTop)):"secondary"===this.type&&this.$menu.hide(),this.$menu.append(this.$menuHolder.append(this.$menuHandle)),this.reset(),this.wPaint.$el.append(this.$menu),this.setAlignment(this.options.alignment)},reset:function(){function e(t){i._appendItem(t)}var n,i=this,s=t.fn.wPaint.menus[this.name];for(n in s.items)this.$menuHolder.children(".wPaint-menu-icon-name-"+n).length||(s.items[n].name=n,s.items[n].img=i.wPaint.options.path+(s.items[n].img||s.img),e(s.items[n]))},_appendItem:function(t){var e=this["_createIcon"+t.icon.capitalize()](t);t.after?this.$menuHolder.children(".wPaint-menu-icon-name-"+t.after).after(e):this.$menuHolder.append(e)},setOffsetLeft:function(t){this.$menu.css({left:t})},setOffsetTop:function(t){this.$menu.css({top:t})},setAlignment:function(t){var e=this.$menu.css("left");this.$menu.attr("class",this.$menu.attr("class").replace(/wPaint-menu-alignment-.+\s|wPaint-menu-alignment-.+$/,"")),this.$menu.addClass("wPaint-menu-alignment-"+t),this.$menu.width("auto").css("left",-1e4),this.$menu.width(this.$menu.width()).css("left",e),"secondary"===this.type&&("horizontal"===this.options.alignment?this.dockOffset.top=this.wPaint.menus.primary.$menu.outerHeight(!0):this.dockOffset.left=this.wPaint.menus.primary.$menu.outerWidth(!0))},_createHandle:function(){var e=this,n=t('<div class="wPaint-menu-handle"></div>');return this.$menu.draggable({handle:n}),"secondary"===this.type&&(this.$menu.draggable("option","snap",this.wPaint.menus.primary.$menu),this.$menu.draggable("option","start",function(){e.docked=!1,e._setDrag()}),this.$menu.draggable("option","stop",function(){t.each(e.$menu.data("ui-draggable").snapElements,function(t,n){var i=e.$menu.offset(),s=e.wPaint.menus.primary.$menu.offset();e.dockOffset.left=i.left-s.left,e.dockOffset.top=i.top-s.top,e.docked=n.snapping}),e._setDrag()}),this.$menu.draggable("option","drag",function(){e._setIndex()})),n.bindMobileEvents(),n},_createIconBase:function(e){var n=this,i=t('<div class="wPaint-menu-icon wPaint-menu-icon-name-'+e.name+'"></div>'),s=t('<div class="wPaint-menu-icon-img"></div>'),a=s.realWidth(null,null,this.wPaint.$el);return i.attr("title",e.title).on("mousedown",t.proxy(this.wPaint._closeSelectBoxes,this.wPaint,e)).on("mouseenter",function(e){var n=t(e.currentTarget);n.siblings(".hover").removeClass("hover"),n.hasClass("disabled")||n.addClass("hover")}).on("mouseleave",function(e){t(e.currentTarget).removeClass("hover")}).on("click",function(){n.wPaint.menus.active=n}),t.isNumeric(e.index)&&s.css({backgroundImage:"url("+e.img+")",backgroundPosition:-a*e.index+"px 0px"}),i.append(s)},_createIconGroup:function(e){function n(){a.children(".wPaint-menu-select-holder").is(":visible")||e.callback.apply(i.wPaint,[])}var i=this,s={backgroundImage:"url("+e.img+")"},a=this.$menuHolder.children(".wPaint-menu-icon-group-"+e.group),o=a.length,h=null,c=null,r=null,l=0;if(o||(a=this._createIconBase(e).addClass("wPaint-menu-icon-group wPaint-menu-icon-group-"+e.group).on("click.setIcon",n).on("mousedown",t.proxy(this._iconClick,this))),l=a.children(".wPaint-menu-icon-img").realWidth(null,null,this.wPaint.$el),s.backgroundPosition=-l*e.index+"px center",(h=a.children(".wPaint-menu-select-holder")).length||(h=this._createSelectBox(a)).children().on("click",function(){a.addClass("active").siblings(".active").removeClass("active")}),r=t('<div class="wPaint-menu-icon-select-img"></div>').attr("title",e.title).css(s),c=this._createSelectOption(h,r).addClass("wPaint-menu-icon-name-"+e.name).on("click",function(){a.attr("title",e.title).off("click.setIcon").on("click.setIcon",n),a.children(".wPaint-menu-icon-img").css(s),e.callback.apply(i.wPaint,[])}),e.after&&h.children(".wPaint-menu-select").children(".wPaint-menu-icon-name-"+e.after).after(c),!o)return a},_createIconGeneric:function(t){return this._createIconActivate(t)},_createIconActivate:function(t){if(t.group)return this._createIconGroup(t);var e=this,n=this._createIconBase(t);return n.on("click",function(n){"generic"!==t.icon&&e._iconClick(n),t.callback.apply(e.wPaint,[n])}),n},_isIconDisabled:function(t){return this.$menuHolder.children(".wPaint-menu-icon-name-"+t).hasClass("disabled")},_setIconDisabled:function(t,e){var n=this.$menuHolder.children(".wPaint-menu-icon-name-"+t);e?n.addClass("disabled").removeClass("hover"):n.removeClass("disabled")},_getIcon:function(t){return this.$menuHolder.children(".wPaint-menu-icon-name-"+t)},_iconClick:function(e){var n=t(e.currentTarget),i=this.wPaint.menus.all;for(var s in i)i[s]&&"secondary"===i[s].type&&i[s].$menu.hide();n.siblings(".active").removeClass("active"),n.hasClass("disabled")||n.addClass("active")},_createIconToggle:function(t){var e=this,n=this._createIconBase(t);return n.on("click",function(){n.toggleClass("active"),t.callback.apply(e.wPaint,[n.hasClass("active")])}),n},_createIconSelect:function(e){function n(n){h.children(".wPaint-menu-icon-img").html(t(n.currentTarget).html()),e.callback.apply(o.wPaint,[t(n.currentTarget).html()])}var i,s,a,o=this,h=this._createIconBase(e),c=this._createSelectBox(h);for(i=0,s=e.range.length;i<s;i++)(a=this._createSelectOption(c,e.range[i])).on("click",n),e.useRange&&a.css(e.name,e.range[i]);return h},_createSelectBox:function(e){var n=t('<div class="wPaint-menu-select-holder"></div>'),i=t('<div class="wPaint-menu-select"></div>'),s=null;return n.on("mousedown mouseup",this.wPaint._stopPropagation).on("click",function(t){t.stopPropagation(),n.hide()}).hide(),"horizontal"===this.options.alignment?n.css({left:0,top:e.children(".wPaint-menu-icon-img").realHeight("outer",!0,this.wPaint.$el)}):n.css({left:e.children(".wPaint-menu-icon-img").realWidth("outer",!0,this.wPaint.$el),top:0}),e.addClass("wPaint-menu-icon-select").append('<div class="wPaint-menu-icon-group-arrow"></div>').append(n.append(i)),e.hasClass("wPaint-menu-icon-group")?e.on("mousedown",function(){s=setTimeout(function(){n.toggle()},200)}).on("mouseup",function(){clearTimeout(s)}):e.on("click",function(){n.toggle()}),n},_createSelectOption:function(e,n){var i=e.children(".wPaint-menu-select"),s=t('<div class="wPaint-menu-select-option"></div>').append(n);return i.children().length||s.addClass("first"),i.append(s),s},_setSelectValue:function(t,e){this._getIcon(t).children(".wPaint-menu-icon-img").html(e)},_createIconColorPicker:function(t){var e=this,n=this._createIconBase(t);return n.on("click",function(){"dropper"===e.wPaint.options.mode&&e.wPaint.setMode(e.wPaint.previousMode)}).addClass("wPaint-menu-colorpicker").wColorPicker({mode:"click",generateButton:!1,dropperButton:!0,onSelect:function(n){t.callback.apply(e.wPaint,[n])},onDropper:function(){n.trigger("click"),e.wPaint.dropper=t.name,e.wPaint.setMode("dropper")}}),n},_setColorPickerValue:function(t,e){this._getIcon(t).children(".wPaint-menu-icon-img").css("backgroundColor",e)},_createIconMenu:function(t){var e=this,n=this._createIconActivate(t);return n.on("click",function(){e.wPaint.setCursor(t.name);var n=e.wPaint.menus.all[t.name];n.$menu.toggle(),e.handle?n._setDrag():n._setPosition()}),n},_setDrag:function(){var e=null,n=null;this.$menu.is(":visible")&&(this.docked&&(e=n=t.proxy(this._setPosition,this),this._setPosition()),this.wPaint.menus.primary.$menu.draggable("option","drag",e),this.wPaint.menus.primary.$menu.draggable("option","stop",n))},_setPosition:function(){var t=this.wPaint.menus.primary.$menu.position();this.$menu.css({left:t.left+this.dockOffset.left,top:t.top+this.dockOffset.top})},_setIndex:function(){var t=this.wPaint.menus.primary.$menu.offset(),e=this.$menu.offset();e.top<t.top||e.left<t.left?this.$menu.addClass("wPaint-menu-behind"):this.$menu.removeClass("wPaint-menu-behind")}},t.support.canvas=document.createElement("canvas").getContext,t.fn.wPaint=function(n,i){function s(){var i=t.data(this,"wPaint");return i||(i=new e(this,t.extend(!0,{},n)),t.data(this,"wPaint",i)),i}if("string"==typeof n){var a=[],o=(i?"set":"get")+n.charAt(0).toUpperCase()+n.substring(1);return this.each(function(){var e=t.data(this,"wPaint");e&&(e[n]?e[n].apply(e,[i]):void 0!==i?(e[o]&&e[o].apply(e,[i]),e.options[n]&&(e.options[n]=i)):e[o]?a.push(e[o].apply(e,[i])):e.options[n]?a.push(e.options[n]):a.push(void 0))}),a.length?1===a.length?a[0]:a:this}return n=t.extend({},t.fn.wPaint.defaults,n),n.lineWidth=parseInt(n.lineWidth,10),n.fontSize=parseInt(n.fontSize,10),this.each(function(){return t.support.canvas?t.proxy(s,this)():(t(this).html("Browser does not support HTML5 canvas, please upgrade to a more modern browser."),!1)})},t.fn.wPaint.extend=function(t,i){function s(n){if(i[n]){var s=e.prototype[n],a=t[n];i[n]=function(){s.apply(this,arguments),a.apply(this,arguments)}}else i[n]=t[n]}var a;i="menu"===i?n.prototype:e.prototype;for(a in t)s(a)},t.fn.wPaint.menus={},t.fn.wPaint.cursors={},t.fn.wPaint.defaults={path:"/",theme:"standard classic",autoScaleImage:!0,autoCenterImage:!0,menuHandle:!0,menuOrientation:"horizontal",menuOffsetLeft:5,menuOffsetTop:5,bg:null,image:null,imageStretch:!1,onShapeDown:null,onShapeMove:null,onShapeUp:null}}(jQuery),String.prototype.capitalize||(String.prototype.capitalize=function(){return this.slice(0,1).toUpperCase()+this.slice(1)}),function(t){t.fn.realWidth=function(e,n,i){var s=null,a=null,o=null;return e="inner"===e||"outer"===e?e:"",o=""===e?"width":e+"Width",n=!0===n,a=t(this).clone().css({position:"absolute",left:-1e4}).appendTo(i||"body"),s=n?a[o](n):a[o](),a.remove(),s},t.fn.realHeight=function(e,n,i){var s=null,a=null,o=null;return e="inner"===e||"outer"===e?e:"",o=""===e?"height":e+"Height",n=!0===n,a=t(this).clone().css({position:"absolute",left:-1e4}).appendTo(i||"body"),s=n?a[o](n):a[o](),a.remove(),s},t.fn.bindMobileEvents=function(){t(this).on("touchstart touchmove touchend touchcancel",function(){var t=(event.changedTouches||event.originalEvent.targetTouches)[0],e="";switch(event.type){case"touchstart":e="mousedown";break;case"touchmove":e="mousemove",event.preventDefault();break;case"touchend":e="mouseup";break;default:return}var n=document.createEvent("MouseEvent");n.initMouseEvent(e,!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(n)})}}(jQuery);